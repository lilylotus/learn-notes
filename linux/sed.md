#### 1. sed 的介绍

> sed 是一种在线的、非交互式的编辑器，它一次处理一行内容。
>  处理时，先把当前处理的行内容存储在临时缓冲区中，称为“模式空间”（pattern space），
>  之后再用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容打印到屏幕。
>  接着处理下一行，这样不断重复，直到文件末尾。
>  `注意：模式空间的内容和 AWK 中的 $0 是一样的，处理每行的时候，都会被重新赋值为当前行的内容`
>  文件内容并没有改变，除非你使用重定向存储输出。
>  Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。

#### 2. sed 命令格式

```bash
sed [options] '[匹配模式] sed 的内部命令' file # 处理单个文件
sed [options] '[匹配模式] sed 的内部命令' file file1 # 处理多个文件
```

>`options` 选项是可选的，意思就是没有也行
>匹配模式是可选的用于在文件中每一行进行匹配到模式，模式可以是正则，也可以是文件的行号
>内部的命令也是可选的，但是**两个单引号**是必须的

**注意：** sed 和 grep 不一样，不管是否找到指定的模式，它的退出状态都是 0，只有当命令存在语法错误时，sed 的退出状态才是非 0

#### 3. 支持的正则表达式

正则表达式是括在斜杠间的模式，用于查找和替换，以下是sed支持的元字符。
使用基本元字符集 `^, $, ., *, [], [^], \< \>,\(\),\{\}`
使用扩展元字符集 `?, +, { }, |, ( )` 使用扩展元字符的方式：`sed -r `

> 在实际使用的时候，都会加上 `-r` 参数，即使没有用的扩展正则也不会有任何影响。

#### 4. sed 的基本用法

##### 4.1 打印

> sed 默认会输出文件的每一行，无论这行内容是否能匹配上匹配模式，假如被匹配到的则会再输出一次。

```bash
sed -r '' file
sed -r 'p' file
```

> *p* 是 sed 的内部命令，是打印 （输出）的作用
> 屏蔽默认输入使用 *-n* 选项

```bash
sed -rn 'p' config
sed -rn '/root/p' config # 仅会显示匹配到 root 的行打印出来
sed -rn 's/^SELINUX=.*/SELINUX=disabled/gp' /etc/selinux/config
	> SELINUX=enforcing
```

##### 4.2 搜索替换 [常用]

> sed 会自动打印文件的每一行，同时查找模式匹配的行，找到后执行后面的命令，
> 默认是 `p` 打印（不加 `-n` 的情况下）
> **注意：**当在模式匹配中使用其他界定符号时，需要对其进行转义。
> 其他界定符用在 `s` 搜索替换时不必转义。

```
sed -rn 's#SELINUX.*#replace#gip' config # 不用转义

sed -r 's/SELINUX/SED/' config # 搜索每一行，只要找到 SELINX 就把第一个替换为 SED
sed -r 's/SELINUX/SED/g' config # 搜索每一行，找到的所有 SELINUX 都替换为 SED [/g]
> g 替换所有， i 忽略大小写，d 删除
```

**g 替换所有， i 忽略大小写，d 删除**

##### 4.3 sed 的行定址

> 地址（定址）决定对哪些 `行` 进行编辑。
> 地址形式可以是数字、正则表达式或二者的结合。
> 如果没有指定地址，sed 将处理输入文件中的所有行。

```bash
sed -r 'd' config # 删除所有行
sed -r '3 d' config # 删除第 3 行
sed -r '1,3 d' config # 删除 1 到 3 行
sed -r '/SELINUX/ d' # 删除含有 SELINUX 行的数据
sed -r '/SELINUX/ !d' # 删除除了含有 SELINUX 行的数据

```

#### sed 命令

> sed 命令告诉 sed 对匹配到的行进行何种操作，包括打印、删除、修改等。

```bash
p 打印行
d 删除行

a 在当前行后添加一行或多行
c 用新文本修改（替换）当前行中的文本
i 在当前行之前插入文本
l 列出非打印字符
n 读入下一输入行，并从下一条命令而不是第一条命令开始对其的处理
! 对所选行以外的所有行应用命令

g 全局替换
r 从文件中读
w 将行写入文件

------------------------ 以下为扩展 -----------------------

h  清除保持空间的内容后，把模式空间里的内容复制到保持空间
H  把模式空间里的内容追加到保持空间
g  清除模式空间的内容后， 取出保持空间的内容，并复制到模式空间
G  取出保持空间的内容，追加在模式空间原有内容的后面
x  交换模式空间与保持空间的内容
```



##### sed 部分命令

1. 替换命令 **s**

   ```bash
   sed -rn 's/[0-9][0-9]/&.5/' config # & 表示在查找中匹配行所有内容
   sed -rn 's/SELINUX=(dis).*/\1-add/gp' config # \1 表示查找到的查找元内的内容 [dis]
   ```

   **& 和 \1 替换查找数据内容**

2. 读文件内容 **r**

   ```bash
   sed -r '2r /etc/issue' config # 把 issue 文件内容插入到 config 文件第 2 行下
   sed -r '/2/r /etc/issue' config # 把 issue 文件内容插入到 config 文件含有 2 行下
   ```

3. 写入命令 **w**

   ```bash
   sed -r '/SELINUX/w newfile' config # 把含有 SELINUX 行的数据写入 newfile
   sed -r '3,$w /etc/selinux/bak' config # 把 3 到最后一行数据写入 bak 文件
   ```

4. 追加命令 **a**

   ```bash
   sed -r '$a 8.8.8.8 www.google.com' /etc/hosts
   ```

5. 插入命令 **i**

   ```bash
   sed -r '2i\11111' config # 在第 2 行后插入
   ```

6. 替换找到某文本的行

   ```bash
   sed -rn '/^port/ c ports' redis.con # 把 port 开头的整行数据换为 ports
   ```

   