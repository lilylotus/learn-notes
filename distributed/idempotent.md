### 接口幂等性

#### 概念

幂等（idempotent、idempotence）是一个数学与计算机学概念，常见于抽象代数中。

在编程中，一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。

这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如，“getUsername() 和 setTrue()” 函数就是一个幂等函数。默认的 `delete` 和 `select` 操作时幂等性的。

幂等性, 通俗的说就是一个接口, 多次发起同一个请求, 必须保证操作只能执行一次，比如:

* 订单接口, 不能多次创建订单
* 支付接口, 重复支付同一笔订单只能扣一次钱
* 支付宝回调接口, 可能会多次回调, 必须处理重复回调
* 普通表单提交接口, 因为网络超时等原因多次点击提交, 只能成功一次 等等

#### 常见的解决方案

* 唯一索引 -- 防止新增脏数据
* token机制 -- 防止页面重复提交
* 悲观锁 -- 获取数据的时候加锁(锁表或锁行)
* 乐观锁 -- 基于版本号version实现, 在更新数据那一刻校验数据
* 分布式锁 -- redis(jedis、redisson )或 zookeeper 实现
* 状态机 -- 状态变更, 更新数据时判断状态